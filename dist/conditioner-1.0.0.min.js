// conditioner v1.0.0 - ConditionerJS - Frizz free, environment-aware, javascript modules.
// Copyright (c) 2014 Rik Schennink - http://conditionerjs.com
// License: MIT (http://www.opensource.org/licenses/mit-license.php)
define("conditioner/Observer",[],function(){var t=1,e={};return{_setEntry:function(n,o){var i=n.__pubSubUID;return i||(i=t++,n.__pubSubUID=i,e[i]={obj:n}),e[i][o]||(e[i][o]=[]),e[i]},_getEntryProp:function(t,n){var o=e[t.__pubSubUID];return o?e[t.__pubSubUID][n]:null},subscribe:function(t,e,n){for(var o,i=this._setEntry(t,"subscriptions"),s=0,r=i.subscriptions,u=r.length;u>s;s++)if(o=r[s],o.type===e&&o.fn===n)return;r.push({type:e,fn:n})},unsubscribe:function(t,e,n){var o=this._getEntryProp(t,"subscriptions");if(o)for(var i,s=o.length;--s>=0;)i=o[s],i.type!==e||i.fn!==n&&n||o.splice(s,1)},publishAsync:function(t,e,n){var o=this;setTimeout(function(){o.publish(t,e,n)},0)},publish:function(t,e,n){for(var o,i=this._setEntry(t,"subscriptions"),s=[],r=0,u=i.subscriptions,l=u.length,a=i.receivers;l>r;r++)o=u[r],o.type===e&&s.push(o);for(l=s.length,r=0;l>r;r++)s[r].fn(n);if(a)for(l=a.length,r=0;l>r;r++)this.publish(a[r],e,n)},inform:function(t,e){if(!t||!e)return!1;var n=this._setEntry(t,"receivers");return n.receivers.push(e),!0},conceal:function(t,e){if(!t||!e)return!1;var n=this._getEntryProp(t,"receivers");if(!n)return!1;for(var o,i=n.length;--i>=0;)if(o=n[i],o===e)return n.splice(i,1),!0;return!1}}}),define("conditioner/contains",[],function(){var t=document?document.body:null;return t&&t.compareDocumentPosition?function(t,e){return!!(16&t.compareDocumentPosition(e))}:t&&t.contains?function(t,e){return t!=e&&t.contains(e)}:function(t,e){for(var n=e.parentNode;n;){if(n===t)return!0;n=n.parentNode}return!1}}),define("conditioner/matchesSelector",[],function(){var t=null,e=document?document.body:null;return!e||e.matches?t="matches":e.webkitMatchesSelector?t="webkitMatchesSelector":e.mozMatchesSelector?t="mozMatchesSelector":e.msMatchesSelector?t="msMatchesSelector":e.oMatchesSelector&&(t="oMatchesSelector"),t?function(e,n){return e[t](n)}:function(t,e){for(var n=(t.parentNode||document).querySelectorAll(e)||[],o=n.length;o--;)if(n[o]==t)return!0;return!1}}),define("conditioner/mergeObjects",[],function(){var t=function(e,n){var o=Array.isArray(n),i=o&&[]||{};return n=n||{},o?i=n.concat():(e&&"object"==typeof e&&Object.keys(e).forEach(function(t){i[t]=e[t]}),Object.keys(n).forEach(function(o){i[o]="object"==typeof n[o]&&n[o]?e[o]?t(e[o],n[o]):n[o]:n[o]})),i};return t}),define(["require","conditioner/Observer","conditioner/contains","conditioner/matchesSelector","conditioner/mergeObjects"],function(t,e,n,o,i){var s=function(t,e){this._expression=t instanceof r||t instanceof s?t:null,this._config=this._expression?null:t,this._negate=e===void 0?!1:e};s.prototype.assignTester=function(t){this._expression=t},s.prototype.getConfig=function(){return this._config?[{expression:this,config:this._config}]:this._expression.getConfig()},s.prototype.succeeds=function(){return this._expression.succeeds?this._expression.succeeds()!==this._negate:!1},s.prototype.toString=function(){return(this._negate?"not ":"")+(this._expression?""+this._expression:this._config.path+":{"+this._config.value+"}")};var r=function(t,e,n){this._a=t,this._operator=e,this._b=n};r.prototype.succeeds=function(){return"and"===this._operator?this._a.succeeds()&&this._b.succeeds():this._a.succeeds()||this._b.succeeds()},r.prototype.toString=function(){return"("+(""+this._a)+" "+this._operator+" "+(""+this._b)+")"},r.prototype.getConfig=function(){return[this._a.getConfig(),this._b.getConfig()]};var u={getExpressionsCount:function(t){return t.match(/(:\{)/g).length},fromString:function(t){var e,n,o,i,u,l,a,h,d,c,_=0,f="",p=[],g="",m=!1,b=!1,v=null,y=null,C=[],M=t.length;for(v||(v=p);M>_;_++)if(u=t.charCodeAt(_),123!==u)if(125===u&&(e=v.length-1,n=e+1,m="not"===v[e],n=m?e:e+1,v[n]=new s({path:f,value:g},m),f="",g="",m=!1,b=!1),b)g+=t.charAt(_);else{if(40===u&&(v.push([]),C.push(v),v=v[v.length-1]),32===u||0===_||40===u){if(o=t.substr(_,5).match(/and |or |not /g),!o)continue;h=o[0],d=h.length-1,v.push(h.substring(0,d)),_+=d}if(41===u||_===M-1)do if(y=C.pop(),0!==v.length){for(i=0,c=v.length;c>i;i++)"string"==typeof v[i]&&("not"===v[i]?(v.splice(i,2,new s(v[i+1],!0)),i=-1,c=v.length):"not"!==v[i+1]&&(v.splice(i-1,3,new r(v[i-1],v[i],v[i+1])),i=-1,c=v.length));1===v.length&&y&&(y[y.length-1]=v[0],v=y)}else v=y;while(_===M-1&&y)}else for(b=!0,f="",l=_-2;l>=0&&(a=t.charCodeAt(l),32!==a&&40!==a);)f=t.charAt(l)+f,l--;return 1===p.length?p[0]:p}},l={_tests:{},_createTest:function(t,n){if(!n.assert)throw Error('TestRegister._addTest(path,config): "config.assert" is a required parameter.');var o=function(){};return o.supported="support"in n?n.support():!0,o._callbacks=[],o._ready=!1,o._setup=function(t){o.supported&&(o._callbacks.push(t.onchange.bind(t)),o._ready||(o._ready=!0,n.setup.call(o,o._measure)))},o._measure=function(t){var e="measure"in n?n.measure.call(o._measure,t):!0;if(e)for(var i=0,s=o._callbacks.length;s>i;i++)o._callbacks[i](t)},o.prototype.supported=function(){return o.supported},o.prototype.onchange=function(){e.publish(this,"change")},o.prototype.arrange=n.arrange?function(t,e){o.supported&&n.arrange.call(this,t,e)}:function(){o._setup(this)},n.measure&&(o.prototype.measure=n.measure),o.prototype.assert=n.assert,o},_findTest:function(t){return this._tests[t]},_storeTest:function(t,e){this._tests[t]=e},getTest:function(e,n){e="conditioner/tests/"+e,t([e],function(t){var o=l._findTest(e);o||(o=l._createTest(e,t),l._storeTest(e,o)),n(new o)})}},a=function(t,n,o){this._test=t,this._expected=n,this._element=o,this._result=!1,this._changed=!0,this._onChangeBind=this._onChange.bind(this),e.subscribe(this._test,"change",this._onChangeBind),this._test.arrange(this._expected,this._element)};a.prototype={_onChange:function(){this._changed=!0},succeeds:function(){return this._changed&&(this._changed=!1,this._result=this._test.assert(this._expected,this._element)),this._result},destroy:function(){e.unsubscribe(this._test,"change",this._onChangeBind)}};var h={_options:{},_redirects:{},registerModule:function(t,e,n){var o,i=requirejs.toUrl(t);this._options[i]=e,n&&(this._redirects[n]=t),o={},o[t]=e,requirejs.config({config:o})},getRedirect:function(t){return this._redirects[t]||t},getModule:function(t){if(!t)throw Error('ModuleRegistry.getModule(path): "path" is a required parameter.');return this._options[t]||this._options[requirejs.toUrl(t)]}},d=function(t,n,o,i){if(!t||!n)throw Error('ModuleController(path,element,options,agent): "path" and "element" are required parameters.');this._path=h.getRedirect(t),this._alias=t,this._element=n,this._options=o||{},this._agent=i||f,this._Module=null,this._module=null,this._initialized=!1,this._onAgentReadyBind=this._onAgentReady.bind(this),this._onAgentStateChangeBind=this._onAgentStateChange.bind(this),this._agent.allowsActivation()?this._initialize():e.subscribe(this._agent,"ready",this._onAgentReadyBind)};d.prototype={hasInitialized:function(){return this._initialized},getModulePath:function(){return this._path},isModuleAvailable:function(){return this._agent.allowsActivation()&&this._module},isModuleActive:function(){return null!==this._module},wrapsModuleWithPath:function(t){return this._path===t||this._alias===t},_onAgentReady:function(){this._initialize()},_initialize:function(){this._initialized=!0,e.subscribe(this._agent,"change",this._onAgentStateChangeBind),e.publish(this,"init",this),this._agent.allowsActivation()&&this._onBecameAvailable()},_onBecameAvailable:function(){e.publish(this,"available",this),this._load()},_onAgentStateChange:function(){var t=this._agent.allowsActivation();this._module&&!t?this._unload():!this._module&&t&&this._onBecameAvailable()},_load:function(){if(this._Module)return this._onLoad(),void 0;var e=this;t([this._path],function(t){if(!t)throw Error("ModuleController: A module needs to export an object.");e._Module=t,e._onLoad()})},_optionsToObject:function(t){if("string"==typeof t)try{return JSON.parse(t)}catch(e){throw Error('ModuleController.load(): "options" is not a valid JSON string.')}return t},_parseOptions:function(t,e,n){var o,s,r=[],u={},l={};do o=h.getModule(t),r.push({page:o,module:e.options}),t=e.__superUrl;while(e=e.__super);for(s=r.length;s--;)u=i(u,r[s].page),l=i(l,r[s].module);return o=i(l,u),n&&(o=i(o,this._optionsToObject(n))),o},_onLoad:function(){if(this._agent.allowsActivation()){var t=this._parseOptions(this._path,this._Module,this._options);if("function"==typeof this._Module?this._module=new this._Module(this._element,t):(this._module=this._Module.load?this._Module.load(this._element,t):null,this._module===void 0&&(this._module=this._Module)),!this._module)throw Error('ModuleController.load(): could not initialize module, missing constructor or "load" method.');e.inform(this._module,this),e.publish(this,"load",this)}},_unload:function(){return this._available=!1,this._module?(e.conceal(this._module,this),this._module.unload&&this._module.unload(),this._module=null,e.publish(this,"unload",this),!0):!1},destroy:function(){this._unload(),e.unsubscribe(this._agent,"ready",this._onAgentReadyBind),e.unsubscribe(this._agent,"change",this._onAgentStateChangeBind),this._agent.destroy()},execute:function(t,e){if(!this._module)return{status:404,response:null};var n=this._module[t];if(!n)throw Error('ModuleController.execute(method,params): function specified in "method" not found on module.');return e=e||[],{status:200,response:n.apply(this._module,e)}}};var c=function(t,e){if(!t)throw Error('NodeController(element): "element" is a required parameter.');this._element=t,this._element.setAttribute("data-processed","true"),this._priority=e?parseInt(e,10):0,this._moduleControllers=[],this._moduleLoadBind=this._onModuleLoad.bind(this),this._moduleUnloadBind=this._onModuleUnload.bind(this)};c.hasProcessed=function(t){return"true"===t.getAttribute("data-processed")},c.prototype={load:function(){if(!arguments||!arguments.length)throw Error("NodeController.load(controllers): Expects an array of module controllers as parameters.");this._moduleControllers=Array.prototype.slice.call(arguments,0);for(var t=0,n=this._moduleControllers.length;n>t;t++)e.subscribe(this._moduleControllers[t],"load",this._moduleLoadBind)},destroy:function(){for(var t=0,e=this._moduleControllers.length;e>t;t++)this._destroyModuleController(this._moduleControllers[t]);this._moduleControllers=[],this._updateInitialized(),this._element.removeAttribute("data-processed"),this._element=null},_destroyModuleController:function(t){e.unsubscribe(t,"load",this._moduleLoadBind),e.unsubscribe(t,"unload",this._moduleUnloadBind),e.conceal(t,this),t.destroy()},getPriority:function(){return this._priority},getElement:function(){return this._element},matchesSelector:function(t,e){return e&&!n(e,this._element)?!1:o(this._element,t,e)},areModulesActive:function(){return this.getActiveModuleControllers().length===this._moduleControllers.length},getActiveModuleControllers:function(){for(var t,e=0,n=this._moduleControllers.length,o=[];n>e;e++)t=this._moduleControllers[e],t.isModuleActive()&&o.push(t);return o},getModuleController:function(t){return this._getModuleControllers(t,!0)},getModuleControllers:function(t){return this._getModuleControllers(t)},_getModuleControllers:function(t,e){if(t===void 0)return e?this._moduleControllers[0]:this._moduleControllers.concat();for(var n,o=0,i=this._moduleControllers.length,s=[];i>o;o++)if(n=this._moduleControllers[o],n.matchesPath(t)){if(e)return n;s.push(n)}return e?null:s},execute:function(t,e){for(var n,o=0,i=this._moduleControllers.length,s=[];i>o;o++)n=this._moduleControllers[o],s.push({controller:n,result:n.execute(t,e)});return s},_onModuleLoad:function(t){e.unsubscribe(t,"load",this._moduleLoadBind),e.subscribe(t,"unload",this._moduleUnloadBind),e.inform(t,this),e.publish(this,"load",t),this._updateInitialized()},_onModuleUnload:function(t){e.subscribe(t,"load",this._moduleLoadBind),e.unsubscribe(t,"unload",this._moduleUnloadBind),e.conceal(t,this),this._updateInitialized()},_updateInitialized:function(){for(var t=0,e=this.getActiveModuleControllers(),n=e.length,o=[];n>t;t++)o.push(e[t].getModulePath());o.length?this._element.setAttribute("data-initialized",o.join(",")):this._element.removeAttribute("data-initialized")}};var _=function(){if(!arguments||!arguments.length)throw Error("SyncedControllerGroup(controllers): Expects an array of node controllers as parameters.");this._inSync=!1,this._controllers=Array.prototype.slice.call(arguments,0),this._controllerLoadedBind=this._onLoad.bind(this),this._controllerUnloadedBind=this._onUnload.bind(this);for(var t,n=0,o=this._controllers.length;o>n;n++)t=this._controllers[n],e.subscribe(t,"load",this._controllerLoadedBind),e.subscribe(t,"unload",this._controllerUnloadedBind);this._test()};_.prototype={destroy:function(){for(var t,n=0,o=this._controllers.length;o>n;n++)t=this._controllers[n],e.unsubscribe(t,"load",this._controllerLoadedBind),e.unsubscribe(t,"unload",this._controllerUnloadedBind);this._controllers=[]},_onLoad:function(){this._test()},_onUnload:function(){this._unload()},_isActiveController:function(t){return t.isModuleActive&&t.isModuleActive()||t.areModulesActive&&t.areModulesActive()},_test:function(){for(var t,e=0,n=this._controllers.length;n>e;e++)if(t=this._controllers[e],!this._isActiveController(t))return;this._load()},_load:function(){this._inSync||(this._inSync=!0,e.publishAsync(this,"load",this._controllers))},_unload:function(){this._inSync&&(this._inSync=!1,e.publish(this,"unload",this._controllers))}};var f={allowsActivation:function(){return!0},destroy:function(){}},p=function(t,e){"string"==typeof t&&t.length&&(this._suitable=!1,this._element=e,this._testers=[],this._onResultsChangedBind=this._onTestResultsChanged.bind(this),this._count=u.getExpressionsCount(t),this._expression=u.fromString(t),this._loadExpressionTests(this._expression.getConfig()))};p.prototype={allowsActivation:function(){return this._suitable},destroy:function(){for(var t=0,n=this._testers.length;n>t;t++)e.unsubscribe(this._testers[t],"change",this._onResultsChangedBind);this._testers=[],this._suitable=!1},_test:function(){var t=this._expression.succeeds();t!=this._suitable&&(this._suitable=t,e.publish(this,"change"))},_loadExpressionTests:function(t){for(var e=0,n=t.length;n>e;e++)Array.isArray(t[e])?this._loadExpressionTests(t[e]):this._loadTesterToExpression(t[e].config,t[e].expression)},_loadTesterToExpression:function(t,n){var o,i=this;l.getTest(t.path,function(s){o=new a(s,t.value,i._element),i._testers.push(o),n.assignTester(o),e.subscribe(s,"change",i._onResultsChangedBind),i._count--,0===i._count&&i._onReady()})},_onReady:function(){this._test(),e.publish(this,"ready")},_onTestResultsChanged:function(){this._test()}};var g=function(){this._options={modules:{}},this._nodes=[]};return g.prototype={init:function(t){t&&this.setOptions(t),this.parse(document)},setOptions:function(t){if(!t)throw Error('ModuleLoader.setOptions(options): "options" is a required parameter.');var e,n,o,s;this._options=i(this._options,t);for(n in this._options.modules)this._options.modules.hasOwnProperty(n)&&(o=this._options.modules[n],s="string"==typeof o?o:o.alias,e="string"==typeof o?null:o.options||{},h.registerModule(n,e,s))},parse:function(t){if(!t)throw Error('ModuleLoader.loadModules(context): "context" is a required parameter.');var e,n,o=t.querySelectorAll("[data-module]"),i=o.length,s=0,r=[];if(!o)return[];for(;i>s;s++)n=o[s],c.hasProcessed(n)||r.push(new c(n,n.getAttribute("data-priority")));for(r.sort(function(t,e){return t.getPriority()-e.getPriority()}),s=r.length;--s>=0;)e=r[s],e.load.apply(e,this._getModuleControllersByElement(e.getElement()));return this._nodes=this._nodes.concat(r),r},load:function(t,e){if(!e)return null;e=e.length?e:[e];var n,o,i=0,s=e.length,r=[];for(n=new c(t);s>i;i++)o=e[i],r.push(this._getModuleController(o.path,t,o.options,o.conditions));return n.load(r),this._nodes.push(n),n},sync:function(){var t=Object.create(_.prototype);return 1!=arguments.length||arguments.slice||(arguments=arguments[0]),_.apply(t,arguments),t},getNode:function(t,e){return this._getNodes(t,e,!0)},getNodes:function(t,e){return this._getNodes(t,e)},_getNodes:function(t,e,n){if(t===void 0&&e===void 0)return n?this._nodes[0]:this._nodes.concat();for(var o,i=0,s=this._nodes.length,r=[];s>i;i++)if(o=this._nodes[i],o.matchesSelector(t,e)){if(n)return o;r.push(o)}return n?null:r},_getModuleControllersByElement:function(t){var e,n,o,i=[],s=t.getAttribute("data-module")||"",r=0,u=91===s.charCodeAt(0);if(u){try{e=JSON.parse(s)}catch(l){throw Error('ModuleLoader.load(context): "data-module" attribute contains a malformed JSON string.')}if(!e)return[];for(o=e.length;o>r;r++)n=e[r],i.push(this._getModuleController(n.path,t,n.options,n.conditions))}else s.length&&i.push(this._getModuleController(s,t,t.getAttribute("data-options"),t.getAttribute("data-conditions")));return i},_getModuleController:function(t,e,n,o){return new d(t,e,n,o?new p(o,e):f)}},new g}),define("conditioner/extendClass",[],function(){return function(){var t,e,n=arguments[arguments.length-1],o=arguments[0];return"string"==typeof o?(t=requirejs,e=o,n.__superUrl=o):(t=o,e=arguments[1],n.__superUrl=t.toUrl(e)),n.__super=t(e),n.prototype=Object.create(n.__super.prototype),n}});